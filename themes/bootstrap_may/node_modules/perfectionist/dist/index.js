'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _commentRegex = require('comment-regex');

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

var _defined = require('defined');

var _defined2 = _interopRequireDefault(_defined);

var _deeplyNested = require('./deeplyNested');

var _deeplyNested2 = _interopRequireDefault(_deeplyNested);

var _getIndent = require('./getIndent');

var _getIndent2 = _interopRequireDefault(_getIndent);

var _longest = require('./longest');

var _longest2 = _interopRequireDefault(_longest);

var _maxSelectorLength = require('./maxSelectorLength');

var _prefixedDecls = require('./prefixedDecls');

var _prefixedDecls2 = _interopRequireDefault(_prefixedDecls);

var _space = require('./space');

var _space2 = _interopRequireDefault(_space);

var _sameLine = require('./sameLine');

var _sameLine2 = _interopRequireDefault(_sameLine);

var _isHexColor = require('./isHexColor');

var _isHexColor2 = _interopRequireDefault(_isHexColor);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var unprefix = _postcss2.default.vendor.unprefixed;

function isSassVariable(decl) {
    return decl.parent.type === 'root' && decl.prop.match(/^\$/);
}

function blank(value) {
    return (0, _defined2.default)(value, '');
}

function applyCompressed(css) {
    css.walk(function (rule) {
        rule.raws.semicolon = false;
        if (rule.type === 'comment' && rule.raws.inline) {
            rule.raws.inline = null;
        }
        if (rule.type === 'rule' || rule.type === 'atrule') {
            rule.raws.between = rule.raws.after = '';
        }
        if (rule.type === 'decl' && !(0, _commentRegex.block)().test(rule.raws.between)) {
            rule.raws.between = ':';
        }
        if (rule.type === 'decl') {
            if (rule.raws.value) {
                rule.value = rule.raws.value.raw.trim();
            }
            // Format sass variable `$size: 30em;`
            if (isSassVariable(rule)) {
                rule.raws.before = '';
                rule.raws.between = ':';
                rule.value = rule.value.trim().replace(/\s+/g, ' ');
            }

            // Remove spaces before commas and keep only one space after.
            rule.value = rule.value.replace(/(\s+)?,(\s)*/g, ',');
            rule.value = rule.value.replace(/\(\s*/g, '(');
            rule.value = rule.value.replace(/\s*\)/g, ')');

            // Format `!important`
            if (rule.important) {
                rule.raws.important = '!important';
            }

            // Format `!default`, `!global` and more similar values.
            if (rule.value.match(/\s*!\s*(\w+)\s*$/i) !== null) {
                rule.value = rule.value.replace(/\s*!\s*(\w+)\s*$/i, '!$1');
            }

            if (rule.raws.value) {
                rule.raws.value.raw = rule.value;
            }
        }
    });
    // Remove final newline
    css.raws.after = '';
}

function applyCompact(css, opts) {
    css.walk(function (rule) {
        if (rule.type === 'decl') {
            if (rule.raws.value) {
                rule.value = rule.raws.value.raw.trim();
            }
            // Format sass variable `$size: 30em;`
            if (isSassVariable(rule)) {
                rule.raws.before = '';
                rule.raws.between = ': ';
                rule.value = rule.value.trim().replace(/\s+/g, ' ');
            }

            // Remove spaces before commas and keep only one space after.
            rule.value = rule.value.replace(/(\s*,\s*)(?=(?:[^"']|['"][^"']*["'])*$)/g, ', ');
            rule.value = rule.value.replace(/\(\s*/g, '( ');
            rule.value = rule.value.replace(/\s*\)/g, ' )');
            // Remove space after comma in data-uri
            rule.value = rule.value.replace(/(data:([a-z]+\/[a-z0-9\-\+]+(;[a-z\-]+\=[a-z0-9\-]+)?)?(;base64)?,)\s+/g, '$1');

            // Format `!important`
            if (rule.important) {
                rule.raws.important = ' !important';
            }

            // Format `!default`, `!global` and more similar values.
            if (rule.value.match(/\s*!\s*(\w+)\s*$/i) !== null) {
                rule.value = rule.value.replace(/\s*!\s*(\w+)\s*$/i, ' !$1');
            }

            if (rule.raws.value) {
                rule.raws.value.raw = rule.value;
            }

            applyTransformFeatures(rule, opts);
        }
        opts.indentSize = 1;
        if (rule.type === 'comment') {
            if (rule.raws.inline) {
                rule.raws.inline = null;
            }
            var prev = rule.prev();
            if (prev && prev.type === 'decl') {
                rule.raws.before = ' ' + blank(rule.raws.before);
            }
            if (rule.parent && rule.parent.type === 'root') {
                var next = rule.next();
                if (next) {
                    next.raws.before = '\n';
                }
                if (rule !== css.first) {
                    rule.raws.before = '\n';
                }
            }
            return;
        }
        var indent = (0, _getIndent2.default)(rule, opts.indentSize);
        var deep = (0, _deeplyNested2.default)(rule);
        if (rule.type === 'rule' || rule.type === 'atrule') {
            if (!rule.nodes) {
                rule.raws.between = '';
            } else {
                rule.raws.between = ' ';
            }
            rule.raws.after = ' ';
            rule.raws.before = indent + blank(rule.raws.before);
            rule.raws.semicolon = true;
        }
        if (rule.raws.selector && rule.raws.selector.raw) {
            rule.selector = rule.raws.selector.raw;
        }
        (0, _maxSelectorLength.maxSelectorLength)(rule, opts);
        if (rule.type === 'decl') {
            if ((0, _deeplyNested2.default)(rule.parent)) {
                var newline = rule === css.first ? '' : '\n';
                rule.raws.before = newline + indent + blank(rule.raws.before);
            } else {
                rule.raws.before = ' ' + blank(rule.raws.before);
            }
            if (!(0, _commentRegex.block)().test(rule.raws.between)) {
                rule.raws.between = ': ';
            }
        }
        if ((deep || rule.nodes) && rule !== css.first) {
            rule.raws.before = '\n ';
        }
        if (deep) {
            rule.raws.after = '\n' + indent;
        }
        if (rule.parent && rule !== rule.parent.first && (rule.type === 'rule' || rule.type === 'atrule')) {
            rule.raws.before = '\n' + indent;
        }
    });
    css.raws.after = '\n';
}

function applyExpanded(css, opts) {
    css.walk(function (rule) {
        if (rule.type === 'decl') {
            if (rule.raws.value) {
                rule.value = rule.raws.value.raw.trim();
            }
            // Format sass variable `$size: 30em;`
            if (isSassVariable(rule)) {
                if (rule !== css.first) {
                    rule.raws.before = '\n';
                }
                rule.raws.between = ': ';
            }

            rule.value = rule.value.trim().replace(/\s+/g, ' ');
            // Remove spaces before commas and keep only one space after.
            rule.value = rule.value.replace(/(\s*,\s*)(?=(?:[^"']|['"][^"']*["'])*$)/g, ', ');
            rule.value = rule.value.replace(/\(\s*/g, '(');
            rule.value = rule.value.replace(/\s*\)/g, ')');
            // Remove space after comma in data-uri
            rule.value = rule.value.replace(/(data:([a-z]+\/[a-z0-9\-\+]+(;[a-z\-]+\=[a-z0-9\-]+)?)?(;base64)?,)\s+/g, '$1');

            // Format `!important`
            if (rule.important) {
                rule.raws.important = ' !important';
            }

            // Format `!default`, `!global` and more similar values.
            if (rule.value.match(/\s*!\s*(\w+)\s*$/i) !== null) {
                rule.value = rule.value.replace(/\s*!\s*(\w+)\s*$/i, ' !$1');
            }

            if (rule.raws.value) {
                rule.raws.value.raw = rule.value;
            }

            applyTransformFeatures(rule, opts);
        }
        var indent = (0, _getIndent2.default)(rule, opts.indentSize);
        if (rule.type === 'comment') {
            var prev = rule.prev();
            if (prev && prev.type === 'decl') {
                if ((0, _sameLine2.default)(prev, rule)) {
                    rule.raws.before = ' ' + blank(rule.raws.before);
                } else {
                    rule.raws.before = '\n' + indent + blank(rule.raws.before);
                }
            }
            if (!prev && rule !== css.first) {
                rule.raws.before = '\n' + indent + blank(rule.raws.before);
            }
            if (rule.parent && rule.parent.type === 'root') {
                var next = rule.next();
                if (next) {
                    next.raws.before = '\n\n';
                }
                if (rule !== css.first) {
                    rule.raws.before = '\n\n';
                }
            }
            return;
        }
        rule.raws.before = indent + blank(rule.raws.before);
        if (rule.type === 'rule' || rule.type === 'atrule') {
            if (!rule.nodes) {
                rule.raws.between = '';
            } else {
                rule.raws.between = ' ';
            }
            rule.raws.semicolon = true;
            if (rule.nodes) {
                rule.raws.after = '\n';
            }
        }
        // visual cascade of vendor prefixed properties
        if (opts.cascade && rule.type === 'rule' && rule.nodes.length > 1) {
            (function () {
                var props = [];
                var prefixed = (0, _prefixedDecls2.default)(rule).sort(_longest2.default).filter(function (_ref) {
                    var prop = _ref.prop;

                    var base = unprefix(prop);
                    if (!~props.indexOf(base)) {
                        return props.push(base);
                    }
                    return false;
                });
                prefixed.forEach(function (prefix) {
                    var base = unprefix(prefix.prop);
                    var vendor = prefix.prop.replace(base, '').length;
                    rule.nodes.filter(function (_ref2) {
                        var prop = _ref2.prop;
                        return prop && ~prop.indexOf(base);
                    }).forEach(function (decl) {
                        var thisVendor = decl.prop.replace(base, '').length;
                        var extraSpace = vendor - thisVendor;
                        if (extraSpace > 0) {
                            decl.raws.before = (0, _space2.default)(extraSpace) + blank(decl.raws.before);
                        }
                    });
                });
            })();
        }
        if (rule.raws.selector && rule.raws.selector.raw) {
            rule.selector = rule.raws.selector.raw;
        }
        (0, _maxSelectorLength.maxSelectorLength)(rule, opts);
        if (rule.type === 'atrule') {
            if (rule.params) {
                rule.raws.afterName = ' ';
            }
            (0, _maxSelectorLength.maxAtRuleLength)(rule, opts);
        }
        if (rule.type === 'decl') {
            if (!(0, _commentRegex.block)().test(rule.raws.between)) {
                rule.raws.between = ': ';
            }
            (0, _maxSelectorLength.maxValueLength)(rule, opts);
        }
        if (rule.parent && rule.parent.type !== 'root') {
            rule.raws.before = '\n' + blank(rule.raws.before);
            rule.raws.after = '\n' + indent;
        }
        if (rule.parent && rule !== rule.parent.first && (rule.type === 'rule' || rule.type === 'atrule')) {
            if (rule.type === 'atrule' && !rule.nodes) {
                rule.raws.before = '\n' + indent;
                return;
            }
            rule.raws.before = '\n\n' + indent;
        }
    });
    css.raws.after = '\n';
}

function applyTransformFeatures(rule, opts) {
    if (rule.type !== 'decl') {
        return;
    }

    // hexadecimal color transformations
    var isColor = (0, _isHexColor2.default)(rule.value);
    if (isColor && opts.colorCase) {
        if (opts.colorCase === 'lower') {
            rule.value = rule.value.toLowerCase();
        } else if (opts.colorCase === 'upper') {
            rule.value = rule.value.toUpperCase();
        }
    }
    if (isColor && opts.colorShorthand) {
        if (opts.colorShorthand === true) {
            rule.value = rule.value.replace(/#([A-Fa-f0-9])\1([A-Fa-f0-9])\2([A-Fa-f0-9])\3/i, '#$1$2$3');
        } else if (opts.colorShorthand === false) {
            rule.value = rule.value.replace(/^#([A-Fa-f0-9])([A-Fa-f0-9])([A-Fa-f0-9])$/i, '#$1$1$2$2$3$3');
        }
    }

    // zeros transformations
    if (opts.zeroLengthNoUnit && opts.zeroLengthNoUnit === true) {
        rule.value = rule.value.replace(/^0[\.0]*(?:px|r?em|ex|ch|vh|vw|cm|mm|in|pt|pc|vmin|vmax)/g, '0');
    }
    if (opts.trimLeadingZero === true) {
        rule.value = rule.value.replace(/(\s|^)(0)(\.\d+)/g, '$1$3');
    } else if (opts.trimLeadingZero === false) {
        rule.value = rule.value.replace(/(\s|^)(\.\d+)/g, '$10$2');
    }
    if (opts.trimTrailingZeros === true) {
        rule.value = rule.value.replace(/(\d+)(\.[0-9]*[1-9]+)(0+)/g, '$1$2');
        rule.value = rule.value.replace(/(\d+)(\.0+)/g, '$1');
    }
}

var perfectionist = _postcss2.default.plugin('perfectionist', function (opts) {
    opts = _extends({
        format: 'expanded',
        indentSize: 4,
        maxAtRuleLength: 80,
        maxSelectorLength: 80,
        maxValueLength: 80,
        trimLeadingZero: true,
        trimTrailingZeros: true,
        cascade: true,
        colorCase: 'lower',
        colorShorthand: true,
        zeroLengthNoUnit: true
    }, opts);

    return function (css) {
        css.walk(function (node) {
            if (node.raws.before) {
                node.raws.before = node.raws.before.replace(/[;\s]/g, '');
            }
        });
        switch (opts.format) {
            case 'compact':
                applyCompact(css, opts);
                break;
            case 'compressed':
                applyCompressed(css);
                break;
            case 'expanded':
            default:
                applyExpanded(css, opts);
                break;
        }
    };
});

perfectionist.process = function (css) {
    var opts = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];

    opts.map = opts.map || (opts.sourcemap ? true : null);
    if (opts.syntax === 'scss') {
        opts.syntax = require('postcss-scss');
    }
    var processor = (0, _postcss2.default)([perfectionist(opts)]);
    return processor.process(css, opts);
};

exports.default = perfectionist;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,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UUFBZCxJQUFjLHlEQUFQLEVBQU87O0FBQ3hDLFNBQUssR0FBTCxHQUFXLEtBQUssR0FBTCxLQUFhLEtBQUssU0FBTCxHQUFpQixJQUFqQixHQUF3QixJQUFyQyxDQUFYO0FBQ0EsUUFBSSxLQUFLLE1BQUwsS0FBZ0IsTUFBcEIsRUFBNEI7QUFDeEIsYUFBSyxNQUFMLEdBQWMsUUFBUSxjQUFSLENBQWQ7QUFDSDtBQUNELFFBQUksWUFBWSx1QkFBUSxDQUFFLGNBQWMsSUFBZCxDQUFGLENBQVIsQ0FBaEI7QUFDQSxXQUFPLFVBQVUsT0FBVixDQUFrQixHQUFsQixFQUF1QixJQUF2QixDQUFQO0FBQ0gsQ0FQRDs7a0JBU2UsYSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7YmxvY2sgYXMgY29tbWVudFJlZ2V4fSBmcm9tICdjb21tZW50LXJlZ2V4JztcbmltcG9ydCBwb3N0Y3NzIGZyb20gJ3Bvc3Rjc3MnO1xuaW1wb3J0IGRlZmluZWQgZnJvbSAnZGVmaW5lZCc7XG5pbXBvcnQgZGVlcGx5TmVzdGVkIGZyb20gJy4vZGVlcGx5TmVzdGVkJztcbmltcG9ydCBnZXRJbmRlbnQgZnJvbSAnLi9nZXRJbmRlbnQnO1xuaW1wb3J0IGxvbmdlc3QgZnJvbSAnLi9sb25nZXN0JztcbmltcG9ydCB7bWF4QXRSdWxlTGVuZ3RoLCBtYXhTZWxlY3Rvckxlbmd0aCwgbWF4VmFsdWVMZW5ndGh9IGZyb20gJy4vbWF4U2VsZWN0b3JMZW5ndGgnO1xuaW1wb3J0IHByZWZpeGVkRGVjbHMgZnJvbSAnLi9wcmVmaXhlZERlY2xzJztcbmltcG9ydCBzcGFjZSBmcm9tICcuL3NwYWNlJztcbmltcG9ydCBzYW1lTGluZSBmcm9tICcuL3NhbWVMaW5lJztcbmltcG9ydCBpc0hleENvbG9yIGZyb20gJy4vaXNIZXhDb2xvcic7XG5cbmxldCB1bnByZWZpeCA9IHBvc3Rjc3MudmVuZG9yLnVucHJlZml4ZWQ7XG5cbmZ1bmN0aW9uIGlzU2Fzc1ZhcmlhYmxlIChkZWNsKSB7XG4gICAgcmV0dXJuIGRlY2wucGFyZW50LnR5cGUgPT09ICdyb290JyAmJiBkZWNsLnByb3AubWF0Y2goL15cXCQvKTtcbn1cblxuZnVuY3Rpb24gYmxhbmsgKHZhbHVlKSB7XG4gICAgcmV0dXJuIGRlZmluZWQodmFsdWUsICcnKTtcbn1cblxuZnVuY3Rpb24gYXBwbHlDb21wcmVzc2VkIChjc3MpIHtcbiAgICBjc3Mud2FsayhydWxlID0+IHtcbiAgICAgICAgcnVsZS5yYXdzLnNlbWljb2xvbiA9IGZhbHNlO1xuICAgICAgICBpZiAocnVsZS50eXBlID09PSAnY29tbWVudCcgJiYgcnVsZS5yYXdzLmlubGluZSkge1xuICAgICAgICAgICAgcnVsZS5yYXdzLmlubGluZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gJ3J1bGUnIHx8IHJ1bGUudHlwZSA9PT0gJ2F0cnVsZScpIHtcbiAgICAgICAgICAgIHJ1bGUucmF3cy5iZXR3ZWVuID0gcnVsZS5yYXdzLmFmdGVyID0gJyc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gJ2RlY2wnICYmICFjb21tZW50UmVnZXgoKS50ZXN0KHJ1bGUucmF3cy5iZXR3ZWVuKSkge1xuICAgICAgICAgICAgcnVsZS5yYXdzLmJldHdlZW4gPSAnOic7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gJ2RlY2wnKSB7XG4gICAgICAgICAgICBpZiAocnVsZS5yYXdzLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUucmF3cy52YWx1ZS5yYXcudHJpbSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRm9ybWF0IHNhc3MgdmFyaWFibGUgYCRzaXplOiAzMGVtO2BcbiAgICAgICAgICAgIGlmIChpc1Nhc3NWYXJpYWJsZShydWxlKSkge1xuICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5iZWZvcmUgPSAnJztcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MuYmV0d2VlbiA9ICc6JztcbiAgICAgICAgICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS50cmltKCkucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZW1vdmUgc3BhY2VzIGJlZm9yZSBjb21tYXMgYW5kIGtlZXAgb25seSBvbmUgc3BhY2UgYWZ0ZXIuXG4gICAgICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS5yZXBsYWNlKC8oXFxzKyk/LChcXHMpKi9nLCAnLCcpO1xuICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvXFwoXFxzKi9nLCAnKCcpO1xuICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvXFxzKlxcKS9nLCAnKScpO1xuXG5cbiAgICAgICAgICAgIC8vIEZvcm1hdCBgIWltcG9ydGFudGBcbiAgICAgICAgICAgIGlmIChydWxlLmltcG9ydGFudCkge1xuICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5pbXBvcnRhbnQgPSAnIWltcG9ydGFudCc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZvcm1hdCBgIWRlZmF1bHRgLCBgIWdsb2JhbGAgYW5kIG1vcmUgc2ltaWxhciB2YWx1ZXMuXG4gICAgICAgICAgICBpZiAocnVsZS52YWx1ZS5tYXRjaCgvXFxzKiFcXHMqKFxcdyspXFxzKiQvaSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS5yZXBsYWNlKC9cXHMqIVxccyooXFx3KylcXHMqJC9pLCAnISQxJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChydWxlLnJhd3MudmFsdWUpIHtcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MudmFsdWUucmF3ID0gcnVsZS52YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIFJlbW92ZSBmaW5hbCBuZXdsaW5lXG4gICAgY3NzLnJhd3MuYWZ0ZXIgPSAnJztcbn1cblxuZnVuY3Rpb24gYXBwbHlDb21wYWN0IChjc3MsIG9wdHMpIHtcbiAgICBjc3Mud2FsayhydWxlID0+IHtcbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gJ2RlY2wnKSB7XG4gICAgICAgICAgICBpZiAocnVsZS5yYXdzLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUucmF3cy52YWx1ZS5yYXcudHJpbSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRm9ybWF0IHNhc3MgdmFyaWFibGUgYCRzaXplOiAzMGVtO2BcbiAgICAgICAgICAgIGlmIChpc1Nhc3NWYXJpYWJsZShydWxlKSkge1xuICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5iZWZvcmUgPSAnJztcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MuYmV0d2VlbiA9ICc6ICc7XG4gICAgICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUudHJpbSgpLnJlcGxhY2UoL1xccysvZywgJyAnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHNwYWNlcyBiZWZvcmUgY29tbWFzIGFuZCBrZWVwIG9ubHkgb25lIHNwYWNlIGFmdGVyLlxuICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvKFxccyosXFxzKikoPz0oPzpbXlwiJ118WydcIl1bXlwiJ10qW1wiJ10pKiQpL2csICcsICcpO1xuICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvXFwoXFxzKi9nLCAnKCAnKTtcbiAgICAgICAgICAgIHJ1bGUudmFsdWUgPSBydWxlLnZhbHVlLnJlcGxhY2UoL1xccypcXCkvZywgJyApJyk7XG4gICAgICAgICAgICAvLyBSZW1vdmUgc3BhY2UgYWZ0ZXIgY29tbWEgaW4gZGF0YS11cmlcbiAgICAgICAgICAgIHJ1bGUudmFsdWUgPSBydWxlLnZhbHVlLnJlcGxhY2UoLyhkYXRhOihbYS16XStcXC9bYS16MC05XFwtXFwrXSsoO1thLXpcXC1dK1xcPVthLXowLTlcXC1dKyk/KT8oO2Jhc2U2NCk/LClcXHMrL2csICckMScpO1xuXG4gICAgICAgICAgICAvLyBGb3JtYXQgYCFpbXBvcnRhbnRgXG4gICAgICAgICAgICBpZiAocnVsZS5pbXBvcnRhbnQpIHtcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MuaW1wb3J0YW50ID0gJyAhaW1wb3J0YW50JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRm9ybWF0IGAhZGVmYXVsdGAsIGAhZ2xvYmFsYCBhbmQgbW9yZSBzaW1pbGFyIHZhbHVlcy5cbiAgICAgICAgICAgIGlmIChydWxlLnZhbHVlLm1hdGNoKC9cXHMqIVxccyooXFx3KylcXHMqJC9pKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJ1bGUudmFsdWUgPSBydWxlLnZhbHVlLnJlcGxhY2UoL1xccyohXFxzKihcXHcrKVxccyokL2ksICcgISQxJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChydWxlLnJhd3MudmFsdWUpIHtcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MudmFsdWUucmF3ID0gcnVsZS52YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXBwbHlUcmFuc2Zvcm1GZWF0dXJlcyhydWxlLCBvcHRzKTtcbiAgICAgICAgfVxuICAgICAgICBvcHRzLmluZGVudFNpemUgPSAxO1xuICAgICAgICBpZiAocnVsZS50eXBlID09PSAnY29tbWVudCcpIHtcbiAgICAgICAgICAgIGlmIChydWxlLnJhd3MuaW5saW5lKSB7XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLmlubGluZSA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcHJldiA9IHJ1bGUucHJldigpO1xuICAgICAgICAgICAgaWYgKHByZXYgJiYgcHJldi50eXBlID09PSAnZGVjbCcpIHtcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MuYmVmb3JlID0gJyAnICsgYmxhbmsocnVsZS5yYXdzLmJlZm9yZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocnVsZS5wYXJlbnQgJiYgcnVsZS5wYXJlbnQudHlwZSA9PT0gJ3Jvb3QnKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5leHQgPSBydWxlLm5leHQoKTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dCkge1xuICAgICAgICAgICAgICAgICAgICBuZXh0LnJhd3MuYmVmb3JlID0gJ1xcbic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChydWxlICE9PSBjc3MuZmlyc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgcnVsZS5yYXdzLmJlZm9yZSA9ICdcXG4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgaW5kZW50ID0gZ2V0SW5kZW50KHJ1bGUsIG9wdHMuaW5kZW50U2l6ZSk7XG4gICAgICAgIGxldCBkZWVwID0gZGVlcGx5TmVzdGVkKHJ1bGUpO1xuICAgICAgICBpZiAocnVsZS50eXBlID09PSAncnVsZScgfHwgcnVsZS50eXBlID09PSAnYXRydWxlJykge1xuICAgICAgICAgICAgaWYgKCFydWxlLm5vZGVzKSB7XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLmJldHdlZW4gPSAnJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLmJldHdlZW4gPSAnICc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBydWxlLnJhd3MuYWZ0ZXIgPSAnICc7XG4gICAgICAgICAgICBydWxlLnJhd3MuYmVmb3JlID0gaW5kZW50ICsgYmxhbmsocnVsZS5yYXdzLmJlZm9yZSk7XG4gICAgICAgICAgICBydWxlLnJhd3Muc2VtaWNvbG9uID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocnVsZS5yYXdzLnNlbGVjdG9yICYmIHJ1bGUucmF3cy5zZWxlY3Rvci5yYXcpIHtcbiAgICAgICAgICAgIHJ1bGUuc2VsZWN0b3IgPSBydWxlLnJhd3Muc2VsZWN0b3IucmF3O1xuICAgICAgICB9XG4gICAgICAgIG1heFNlbGVjdG9yTGVuZ3RoKHJ1bGUsIG9wdHMpO1xuICAgICAgICBpZiAocnVsZS50eXBlID09PSAnZGVjbCcpIHtcbiAgICAgICAgICAgIGlmIChkZWVwbHlOZXN0ZWQocnVsZS5wYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5ld2xpbmUgPSBydWxlID09PSBjc3MuZmlyc3QgPyAnJyA6ICdcXG4nO1xuICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5iZWZvcmUgPSBuZXdsaW5lICsgaW5kZW50ICsgYmxhbmsocnVsZS5yYXdzLmJlZm9yZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5iZWZvcmUgPSAnICcgKyBibGFuayhydWxlLnJhd3MuYmVmb3JlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghY29tbWVudFJlZ2V4KCkudGVzdChydWxlLnJhd3MuYmV0d2VlbikpIHtcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MuYmV0d2VlbiA9ICc6ICc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChkZWVwIHx8IHJ1bGUubm9kZXMpICYmIHJ1bGUgIT09IGNzcy5maXJzdCkge1xuICAgICAgICAgICAgcnVsZS5yYXdzLmJlZm9yZSA9ICdcXG4gJztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVlcCkge1xuICAgICAgICAgICAgcnVsZS5yYXdzLmFmdGVyID0gJ1xcbicgKyBpbmRlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJ1bGUucGFyZW50ICYmIHJ1bGUgIT09IHJ1bGUucGFyZW50LmZpcnN0ICYmIChydWxlLnR5cGUgPT09ICdydWxlJyB8fCBydWxlLnR5cGUgPT09ICdhdHJ1bGUnKSkge1xuICAgICAgICAgICAgcnVsZS5yYXdzLmJlZm9yZSA9ICdcXG4nICsgaW5kZW50O1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY3NzLnJhd3MuYWZ0ZXIgPSAnXFxuJztcbn1cblxuZnVuY3Rpb24gYXBwbHlFeHBhbmRlZCAoY3NzLCBvcHRzKSB7XG4gICAgY3NzLndhbGsocnVsZSA9PiB7XG4gICAgICAgIGlmIChydWxlLnR5cGUgPT09ICdkZWNsJykge1xuICAgICAgICAgICAgaWYgKHJ1bGUucmF3cy52YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJ1bGUudmFsdWUgPSBydWxlLnJhd3MudmFsdWUucmF3LnRyaW0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEZvcm1hdCBzYXNzIHZhcmlhYmxlIGAkc2l6ZTogMzBlbTtgXG4gICAgICAgICAgICBpZiAoaXNTYXNzVmFyaWFibGUocnVsZSkpIHtcbiAgICAgICAgICAgICAgICBpZiAocnVsZSAhPT0gY3NzLmZpcnN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5iZWZvcmUgPSAnXFxuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLmJldHdlZW4gPSAnOiAnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS50cmltKCkucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHNwYWNlcyBiZWZvcmUgY29tbWFzIGFuZCBrZWVwIG9ubHkgb25lIHNwYWNlIGFmdGVyLlxuICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvKFxccyosXFxzKikoPz0oPzpbXlwiJ118WydcIl1bXlwiJ10qW1wiJ10pKiQpL2csICcsICcpO1xuICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvXFwoXFxzKi9nLCAnKCcpO1xuICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvXFxzKlxcKS9nLCAnKScpO1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHNwYWNlIGFmdGVyIGNvbW1hIGluIGRhdGEtdXJpXG4gICAgICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS5yZXBsYWNlKC8oZGF0YTooW2Etel0rXFwvW2EtejAtOVxcLVxcK10rKDtbYS16XFwtXStcXD1bYS16MC05XFwtXSspPyk/KDtiYXNlNjQpPywpXFxzKy9nLCAnJDEnKTtcblxuICAgICAgICAgICAgLy8gRm9ybWF0IGAhaW1wb3J0YW50YFxuICAgICAgICAgICAgaWYgKHJ1bGUuaW1wb3J0YW50KSB7XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLmltcG9ydGFudCA9ICcgIWltcG9ydGFudCc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZvcm1hdCBgIWRlZmF1bHRgLCBgIWdsb2JhbGAgYW5kIG1vcmUgc2ltaWxhciB2YWx1ZXMuXG4gICAgICAgICAgICBpZiAocnVsZS52YWx1ZS5tYXRjaCgvXFxzKiFcXHMqKFxcdyspXFxzKiQvaSkgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS5yZXBsYWNlKC9cXHMqIVxccyooXFx3KylcXHMqJC9pLCAnICEkMScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocnVsZS5yYXdzLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLnZhbHVlLnJhdyA9IHJ1bGUudmFsdWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFwcGx5VHJhbnNmb3JtRmVhdHVyZXMocnVsZSwgb3B0cyk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGluZGVudCA9IGdldEluZGVudChydWxlLCBvcHRzLmluZGVudFNpemUpO1xuICAgICAgICBpZiAocnVsZS50eXBlID09PSAnY29tbWVudCcpIHtcbiAgICAgICAgICAgIGxldCBwcmV2ID0gcnVsZS5wcmV2KCk7XG4gICAgICAgICAgICBpZiAocHJldiAmJiBwcmV2LnR5cGUgPT09ICdkZWNsJykge1xuICAgICAgICAgICAgICAgIGlmIChzYW1lTGluZShwcmV2LCBydWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBydWxlLnJhd3MuYmVmb3JlID0gJyAnICsgYmxhbmsocnVsZS5yYXdzLmJlZm9yZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcnVsZS5yYXdzLmJlZm9yZSA9ICdcXG4nICsgaW5kZW50ICsgYmxhbmsocnVsZS5yYXdzLmJlZm9yZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFwcmV2ICYmIHJ1bGUgIT09IGNzcy5maXJzdCkge1xuICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5iZWZvcmUgPSAnXFxuJyArIGluZGVudCArIGJsYW5rKHJ1bGUucmF3cy5iZWZvcmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJ1bGUucGFyZW50ICYmIHJ1bGUucGFyZW50LnR5cGUgPT09ICdyb290Jykge1xuICAgICAgICAgICAgICAgIGxldCBuZXh0ID0gcnVsZS5uZXh0KCk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV4dC5yYXdzLmJlZm9yZSA9ICdcXG5cXG4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocnVsZSAhPT0gY3NzLmZpcnN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5iZWZvcmUgPSAnXFxuXFxuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcnVsZS5yYXdzLmJlZm9yZSA9IGluZGVudCArIGJsYW5rKHJ1bGUucmF3cy5iZWZvcmUpO1xuICAgICAgICBpZiAocnVsZS50eXBlID09PSAncnVsZScgfHwgcnVsZS50eXBlID09PSAnYXRydWxlJykge1xuICAgICAgICAgICAgaWYgKCFydWxlLm5vZGVzKSB7XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLmJldHdlZW4gPSAnJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLmJldHdlZW4gPSAnICc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBydWxlLnJhd3Muc2VtaWNvbG9uID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChydWxlLm5vZGVzKSB7XG4gICAgICAgICAgICAgICAgcnVsZS5yYXdzLmFmdGVyID0gJ1xcbic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gdmlzdWFsIGNhc2NhZGUgb2YgdmVuZG9yIHByZWZpeGVkIHByb3BlcnRpZXNcbiAgICAgICAgaWYgKG9wdHMuY2FzY2FkZSAmJiBydWxlLnR5cGUgPT09ICdydWxlJyAmJiBydWxlLm5vZGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGxldCBwcm9wcyA9IFtdO1xuICAgICAgICAgICAgbGV0IHByZWZpeGVkID0gcHJlZml4ZWREZWNscyhydWxlKS5zb3J0KGxvbmdlc3QpLmZpbHRlcigoe3Byb3B9KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGJhc2UgPSB1bnByZWZpeChwcm9wKTtcbiAgICAgICAgICAgICAgICBpZiAoIX5wcm9wcy5pbmRleE9mKGJhc2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wcy5wdXNoKGJhc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHByZWZpeGVkLmZvckVhY2gocHJlZml4ID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgYmFzZSA9IHVucHJlZml4KHByZWZpeC5wcm9wKTtcbiAgICAgICAgICAgICAgICBsZXQgdmVuZG9yID0gcHJlZml4LnByb3AucmVwbGFjZShiYXNlLCAnJykubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHJ1bGUubm9kZXMuZmlsdGVyKCh7cHJvcH0pID0+IHByb3AgJiYgfnByb3AuaW5kZXhPZihiYXNlKSkuZm9yRWFjaChkZWNsID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRoaXNWZW5kb3IgPSBkZWNsLnByb3AucmVwbGFjZShiYXNlLCAnJykubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZXh0cmFTcGFjZSA9IHZlbmRvciAtIHRoaXNWZW5kb3I7XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHRyYVNwYWNlID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVjbC5yYXdzLmJlZm9yZSA9IHNwYWNlKGV4dHJhU3BhY2UpICsgYmxhbmsoZGVjbC5yYXdzLmJlZm9yZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChydWxlLnJhd3Muc2VsZWN0b3IgJiYgcnVsZS5yYXdzLnNlbGVjdG9yLnJhdykge1xuICAgICAgICAgICAgcnVsZS5zZWxlY3RvciA9IHJ1bGUucmF3cy5zZWxlY3Rvci5yYXc7XG4gICAgICAgIH1cbiAgICAgICAgbWF4U2VsZWN0b3JMZW5ndGgocnVsZSwgb3B0cyk7XG4gICAgICAgIGlmIChydWxlLnR5cGUgPT09ICdhdHJ1bGUnKSB7XG4gICAgICAgICAgICBpZiAocnVsZS5wYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MuYWZ0ZXJOYW1lID0gJyAnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWF4QXRSdWxlTGVuZ3RoKHJ1bGUsIG9wdHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChydWxlLnR5cGUgPT09ICdkZWNsJykge1xuICAgICAgICAgICAgaWYgKCFjb21tZW50UmVnZXgoKS50ZXN0KHJ1bGUucmF3cy5iZXR3ZWVuKSkge1xuICAgICAgICAgICAgICAgIHJ1bGUucmF3cy5iZXR3ZWVuID0gJzogJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1heFZhbHVlTGVuZ3RoKHJ1bGUsIG9wdHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChydWxlLnBhcmVudCAmJiBydWxlLnBhcmVudC50eXBlICE9PSAncm9vdCcpIHtcbiAgICAgICAgICAgIHJ1bGUucmF3cy5iZWZvcmUgPSAnXFxuJyArIGJsYW5rKHJ1bGUucmF3cy5iZWZvcmUpO1xuICAgICAgICAgICAgcnVsZS5yYXdzLmFmdGVyID0gJ1xcbicgKyBpbmRlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJ1bGUucGFyZW50ICYmIHJ1bGUgIT09IHJ1bGUucGFyZW50LmZpcnN0ICYmIChydWxlLnR5cGUgPT09ICdydWxlJyB8fCBydWxlLnR5cGUgPT09ICdhdHJ1bGUnKSkge1xuICAgICAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gJ2F0cnVsZScgJiYgIXJ1bGUubm9kZXMpIHtcbiAgICAgICAgICAgICAgICBydWxlLnJhd3MuYmVmb3JlID0gJ1xcbicgKyBpbmRlbnQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcnVsZS5yYXdzLmJlZm9yZSA9ICdcXG5cXG4nICsgaW5kZW50O1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY3NzLnJhd3MuYWZ0ZXIgPSAnXFxuJztcbn1cblxuZnVuY3Rpb24gYXBwbHlUcmFuc2Zvcm1GZWF0dXJlcyAocnVsZSwgb3B0cykge1xuICAgIGlmIChydWxlLnR5cGUgIT09ICdkZWNsJykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gaGV4YWRlY2ltYWwgY29sb3IgdHJhbnNmb3JtYXRpb25zXG4gICAgY29uc3QgaXNDb2xvciA9IGlzSGV4Q29sb3IocnVsZS52YWx1ZSk7XG4gICAgaWYgKGlzQ29sb3IgJiYgb3B0cy5jb2xvckNhc2UpIHtcbiAgICAgICAgaWYgKG9wdHMuY29sb3JDYXNlID09PSAnbG93ZXInKSB7XG4gICAgICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdHMuY29sb3JDYXNlID09PSAndXBwZXInKSB7XG4gICAgICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChpc0NvbG9yICYmIG9wdHMuY29sb3JTaG9ydGhhbmQpIHtcbiAgICAgICAgaWYgKG9wdHMuY29sb3JTaG9ydGhhbmQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJ1bGUudmFsdWUgPSBydWxlLnZhbHVlLnJlcGxhY2UoLyMoW0EtRmEtZjAtOV0pXFwxKFtBLUZhLWYwLTldKVxcMihbQS1GYS1mMC05XSlcXDMvaSwgJyMkMSQyJDMnKTtcbiAgICAgICAgfSBlbHNlIGlmIChvcHRzLmNvbG9yU2hvcnRoYW5kID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvXiMoW0EtRmEtZjAtOV0pKFtBLUZhLWYwLTldKShbQS1GYS1mMC05XSkkL2ksICcjJDEkMSQyJDIkMyQzJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB6ZXJvcyB0cmFuc2Zvcm1hdGlvbnNcbiAgICBpZiAob3B0cy56ZXJvTGVuZ3RoTm9Vbml0ICYmIG9wdHMuemVyb0xlbmd0aE5vVW5pdCA9PT0gdHJ1ZSkge1xuICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS5yZXBsYWNlKC9eMFtcXC4wXSooPzpweHxyP2VtfGV4fGNofHZofHZ3fGNtfG1tfGlufHB0fHBjfHZtaW58dm1heCkvZywgJzAnKTtcbiAgICB9XG4gICAgaWYgKG9wdHMudHJpbUxlYWRpbmdaZXJvID09PSB0cnVlKSB7XG4gICAgICAgIHJ1bGUudmFsdWUgPSBydWxlLnZhbHVlLnJlcGxhY2UoLyhcXHN8XikoMCkoXFwuXFxkKykvZywgJyQxJDMnKTtcbiAgICB9IGVsc2UgaWYgKG9wdHMudHJpbUxlYWRpbmdaZXJvID09PSBmYWxzZSkge1xuICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS5yZXBsYWNlKC8oXFxzfF4pKFxcLlxcZCspL2csICckMTAkMicpO1xuICAgIH1cbiAgICBpZiAob3B0cy50cmltVHJhaWxpbmdaZXJvcyA9PT0gdHJ1ZSkge1xuICAgICAgICBydWxlLnZhbHVlID0gcnVsZS52YWx1ZS5yZXBsYWNlKC8oXFxkKykoXFwuWzAtOV0qWzEtOV0rKSgwKykvZywgJyQxJDInKTtcbiAgICAgICAgcnVsZS52YWx1ZSA9IHJ1bGUudmFsdWUucmVwbGFjZSgvKFxcZCspKFxcLjArKS9nLCAnJDEnKTtcbiAgICB9XG59XG5cbmNvbnN0IHBlcmZlY3Rpb25pc3QgPSBwb3N0Y3NzLnBsdWdpbigncGVyZmVjdGlvbmlzdCcsIG9wdHMgPT4ge1xuICAgIG9wdHMgPSB7XG4gICAgICAgIGZvcm1hdDogJ2V4cGFuZGVkJyxcbiAgICAgICAgaW5kZW50U2l6ZTogNCxcbiAgICAgICAgbWF4QXRSdWxlTGVuZ3RoOiA4MCxcbiAgICAgICAgbWF4U2VsZWN0b3JMZW5ndGg6IDgwLFxuICAgICAgICBtYXhWYWx1ZUxlbmd0aDogODAsXG4gICAgICAgIHRyaW1MZWFkaW5nWmVybzogdHJ1ZSxcbiAgICAgICAgdHJpbVRyYWlsaW5nWmVyb3M6IHRydWUsXG4gICAgICAgIGNhc2NhZGU6IHRydWUsXG4gICAgICAgIGNvbG9yQ2FzZTogJ2xvd2VyJyxcbiAgICAgICAgY29sb3JTaG9ydGhhbmQ6IHRydWUsXG4gICAgICAgIHplcm9MZW5ndGhOb1VuaXQ6IHRydWUsXG4gICAgICAgIC4uLm9wdHMsXG4gICAgfTtcblxuICAgIHJldHVybiBjc3MgPT4ge1xuICAgICAgICBjc3Mud2Fsayhub2RlID0+IHtcbiAgICAgICAgICAgIGlmIChub2RlLnJhd3MuYmVmb3JlKSB7XG4gICAgICAgICAgICAgICAgbm9kZS5yYXdzLmJlZm9yZSA9IG5vZGUucmF3cy5iZWZvcmUucmVwbGFjZSgvWztcXHNdL2csICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHN3aXRjaCAob3B0cy5mb3JtYXQpIHtcbiAgICAgICAgY2FzZSAnY29tcGFjdCc6XG4gICAgICAgICAgICBhcHBseUNvbXBhY3QoY3NzLCBvcHRzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdjb21wcmVzc2VkJzpcbiAgICAgICAgICAgIGFwcGx5Q29tcHJlc3NlZChjc3MpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2V4cGFuZGVkJzpcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGFwcGx5RXhwYW5kZWQoY3NzLCBvcHRzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfTtcbn0pO1xuXG5wZXJmZWN0aW9uaXN0LnByb2Nlc3MgPSAoY3NzLCBvcHRzID0ge30pID0+IHtcbiAgICBvcHRzLm1hcCA9IG9wdHMubWFwIHx8IChvcHRzLnNvdXJjZW1hcCA/IHRydWUgOiBudWxsKTtcbiAgICBpZiAob3B0cy5zeW50YXggPT09ICdzY3NzJykge1xuICAgICAgICBvcHRzLnN5bnRheCA9IHJlcXVpcmUoJ3Bvc3Rjc3Mtc2NzcycpO1xuICAgIH1cbiAgICBsZXQgcHJvY2Vzc29yID0gcG9zdGNzcyhbIHBlcmZlY3Rpb25pc3Qob3B0cykgXSk7XG4gICAgcmV0dXJuIHByb2Nlc3Nvci5wcm9jZXNzKGNzcywgb3B0cyk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBwZXJmZWN0aW9uaXN0O1xuIl19